<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>{{ page_title or "AI-RADAR" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <header>
    <div class="container">
      <div class="nav-flex">
        <!-- BLOCCO LOGO PRINCIPALE: AI-RADAR -->
        <div class="logo-block">
          <div style="display:flex; align-items:center; gap:0.8rem;">
            <!-- SVG CONCEPT 1: AI-RADAR -->
            <svg width="190" height="50" viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg">
              <g transform="translate(20, 30)">
                  <circle cx="0" cy="0" r="18" fill="none" stroke="#333" stroke-width="2"/>
                  <circle cx="0" cy="0" r="10" fill="none" stroke="#00F3FF" stroke-width="2" opacity="0.6"/>
                  <circle cx="0" cy="0" r="4" fill="#00F3FF">
                      <animate attributeName="opacity" values="1;0.2;1" dur="2s" repeatCount="indefinite"/>
                  </circle>
                  <path d="M0,0 L14,-14 A18,18 0 0,1 18,0" fill="url(#grad1)" opacity="0.8">
                       <animateTransform attributeName="transform"
                                         type="rotate"
                                         from="0 0 0"
                                         to="360 0 0"
                                         dur="3s"
                                         repeatCount="indefinite"/>
                  </path>
              </g>
              <text x="55" y="38"
                    fill="white"
                    font-family="Arial, sans-serif"
                    font-weight="bold"
                    font-size="20">
                AI<tspan fill="#00F3FF">-RADAR</tspan>.it
              </text>
              <defs>
                  <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" style="stop-color:#00F3FF;stop-opacity:0" />
                      <stop offset="100%" style="stop-color:#00F3FF;stop-opacity:0.5" />
                  </linearGradient>
              </defs>
            </svg>

            <!-- MICRO TAGLINE TESTUALE -->
            <div>
              <div class="logo-main mono-font">AI-RADAR.it</div>
              <div class="logo-sub">
                News &amp; analisi per LLM locali, stack e hardware on-prem.
              </div>
            </div>
          </div>
        </div>

        <!-- NAV -->
        <nav class="nav-links">
          <a href="/">Home</a>
          <a href="/category/llm">LLM</a>
          <a href="/category/frameworks">Frameworks</a>
          <a href="/category/hardware">Hardware</a>
          <a href="/tags">üè∑Ô∏è Tags</a>
          <a href="/llm-onpremise" style="color: var(--neon-green); border: 1px solid var(--neon-green); padding: 0.4rem 0.7rem; border-radius: 999px;">üíª LLMOnPremise</a>
          <a href="/ask" class="nav-pill-disabled">Ask Observatory</a>
          {% if current_user %}
            {% if current_user.is_admin %}
              <a href="/admin/new" class="nav-cta">+ Editorial / Post</a>
            {% endif %}
            <a href="/logout" style="color: var(--text-muted);">Logout (@{{ current_user.username }})</a>
          {% else %}
            <a href="/login">Login</a>
            <a href="/register" class="nav-cta">Register</a>
          {% endif %}
        </nav>

        <!-- SEARCH -->
        <form class="search-form" method="get" action="/search">
          <input
            class="search-input"
            type="text"
            name="q"
            placeholder="Search LLM, framework, hardware..."
            value="{{ request.query_params.get('q') or '' }}"
          />
          <button class="search-btn" type="submit">Search</button>
        </form>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      {% block content %}{% endblock %}
    </div>
  </main>

  <footer>
    <div class="container">
      <!-- Newsletter Signup -->
      <div style="background: var(--bg-card); padding: 2rem; border-radius: 8px; margin-bottom: 2rem; border: 1px solid var(--neon-cyan);">
        <div style="max-width: 600px; margin: 0 auto; text-align: center;">
          <h3 style="color: var(--neon-cyan); margin-bottom: 0.5rem;">üì¨ Newsletter AI-RADAR</h3>
          <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
            Ricevi aggiornamenti settimanali su AI, LLM e hardware on-premise
          </p>
          <form id="newsletterForm" style="display: flex; gap: 0.5rem; justify-content: center;">
            <input 
              type="email" 
              id="newsletterEmail" 
              placeholder="Il tuo indirizzo email" 
              required
              style="flex: 1; max-width: 400px; padding: 0.8rem; background: var(--bg-main); color: var(--text-main); border: 1px solid var(--border-dim); border-radius: 4px;"
            >
            <button 
              type="submit"
              style="padding: 0.8rem 1.5rem; background: var(--neon-cyan); color: #000; border: none; border-radius: 4px; font-weight: 600; cursor: pointer;"
            >
              Iscriviti
            </button>
          </form>
          <div id="newsletterMessage" style="margin-top: 1rem; font-size: 0.9em;"></div>
        </div>
      </div>
      
      <!-- Footer Info -->
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div>
          AI-RADAR.it ¬∑ LLM on-premise, stack locali e analisi editoriali.
        </div>
        <div style="display: flex; gap: 1.5rem; font-size: 0.85em; color: var(--text-secondary);">
          <span id="lastUpdate">‚è±Ô∏è Caricamento...</span>
          <a href="/health" style="color: var(--neon-cyan); text-decoration: none;">üíö Status</a>
        </div>
      </div>
    </div>
  </footer>
  
  <script>
    // Newsletter subscription
    document.getElementById('newsletterForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('newsletterEmail').value;
      const messageDiv = document.getElementById('newsletterMessage');
      
      try {
        const formData = new FormData();
        formData.append('email', email);
        
        const response = await fetch('/newsletter/subscribe', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        messageDiv.style.color = data.success ? 'var(--neon-cyan)' : '#ff6b6b';
        messageDiv.textContent = data.message;
        
        if (data.success) {
          document.getElementById('newsletterEmail').value = '';
        }
      } catch (error) {
        messageDiv.style.color = '#ff6b6b';
        messageDiv.textContent = '‚ùå Errore durante l\'iscrizione';
      }
    });
    
    // Fetch and display last update time
    fetch('/health')
      .then(res => res.json())
      .then(data => {
        if (data.last_update) {
          const date = new Date(data.last_update);
          const formatted = date.toLocaleString('it-IT', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit' 
          });
          document.getElementById('lastUpdate').textContent = `‚è±Ô∏è Ultimo aggiornamento: ${formatted}`;
        } else {
          document.getElementById('lastUpdate').textContent = '‚è±Ô∏è Aggiornamenti in corso...';
        }
      })
      .catch(() => {
        document.getElementById('lastUpdate').textContent = '‚è±Ô∏è --';
      });
  </script>
</body>
</html>
