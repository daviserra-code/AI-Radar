{% extends "base.html" %}
{% block content %}

<section class="hero">
  <div class="hero-main">
    <h1>AI-RADAR per LLM <span>on-prem</span> &amp; AI in casa</h1>
    <p>
      Il radar quotidiano su modelli, framework e hardware per far girare
      l'AI in locale. LLM, LangChain, Chroma, mini-PC e tutto ciÃ² che serve
      per un cervello distribuito "in-house".
    </p>
    <div class="hero-chips">
      <div class="hero-chip">
        âš™ï¸ Stack: LLM locali Â· LangChain Â· Transformers Â· ChromaDB Â· MiniPC Â· AI boxes
      </div>
      <div class="hero-chip hero-chip-secondary">
        ğŸ›°ï¸ Ask Observatory (Q&amp;A + RAG) giÃ  collegato all'archivio articoli.
      </div>
    </div>
  </div>
</section>

<!-- Floating Stats Button -->
<button id="statsToggle" style="
  position: fixed;
  right: 2rem;
  top: 50%;
  transform: translateY(-50%);
  background: var(--bg-card);
  border: 1px solid var(--neon-cyan);
  color: var(--neon-cyan);
  padding: 0.8rem 1rem;
  border-radius: 8px 0 0 8px;
  cursor: pointer;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  z-index: 1000;
  transition: all 0.3s;
  box-shadow: -4px 0 12px rgba(0, 0, 0, 0.5);
" onclick="toggleStats()">
  ğŸ“Š Stats
</button>

<!-- Floating Stats Panel -->
<aside id="statsPanel" style="
  position: fixed;
  right: -400px;
  top: 0;
  height: 100vh;
  width: 350px;
  background: var(--bg-card);
  border-left: 2px solid var(--neon-cyan);
  padding: 2rem;
  overflow-y: auto;
  z-index: 999;
  transition: right 0.3s ease;
  box-shadow: -4px 0 20px rgba(0, 0, 0, 0.7);
">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h3 style="font-size: 1.2rem; color: var(--neon-cyan);">ğŸ“Š Statistiche</h3>
    <button onclick="toggleStats()" style="
      background: transparent;
      border: 1px solid var(--border-dim);
      color: var(--text-muted);
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1.2rem;
    ">Ã—</button>
  </div>

  <div class="hero-side-title">Archivio Totale</div>
  <div style="font-size: 2.5rem; font-weight: bold; color: var(--neon-cyan); margin-bottom: 0.5rem;">
    {{ total_articles }}
  </div>
  <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 2rem;">
    Articoli indicizzati nel sistema RAG
  </div>

  {% if category_stats %}
  <div class="hero-side-title" style="margin-top: 1.5rem;">Categorie</div>
  <ul class="hero-list" style="list-style: none; padding: 0;">
    {% for stat in category_stats %}
    <li style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0;">
      <a href="/category/{{ stat.slug }}"
        style="color: var(--text-main); text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
        <span style="font-size: 1.2rem;">{{ stat.icon or 'ğŸ“' }}</span>
        <span>{{ stat.name }}</span>
      </a>
      <span style="color: var(--neon-cyan); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;">
        {{ stat.count }}
      </span>
    </li>
    {% endfor %}
  </ul>
  {% endif %}

  <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-dim);">
    <a href="/rss" style="color: var(--neon-cyan); font-size: 0.85rem; text-decoration: none;">
      ğŸ“¡ RSS Feed
    </a>
  </div>
</aside>

<script>
  function toggleStats() {
    const panel = document.getElementById('statsPanel');
    const button = document.getElementById('statsToggle');
    const isOpen = panel.style.right === '0px';

    if (isOpen) {
      panel.style.right = '-400px';
      button.style.right = '2rem';
    } else {
      panel.style.right = '0px';
      button.style.right = '370px';
    }
  }
</script>

<section class="section-header">
  <h2>Ultime analisi &amp; news dal radar</h2>
  <p>
    Articoli generati dall'AI sulla base dei feed, con spazio per layer
    editoriale umano sopra il contenuto grezzo.
  </p>
</section>

<section class="news-grid">
  {% for article in articles %}
  <article class="card">
    {% if article.image_url %}
    <div style="margin: -1.5rem -1.5rem 1rem -1.5rem; overflow: hidden; border-radius: 8px 8px 0 0;">
      <img src="{{ article.image_url }}" alt="{{ article.title }}" loading="lazy"
        style="width: 100%; height: 180px; object-fit: cover; display: block; image-rendering: -webkit-optimize-contrast; image-rendering: smooth;">
    </div>
    {% endif %}

    <div>
      <div>
        <span class="card-tag">
          {% if article.category %}
          {{ article.category.icon or 'ğŸ“' }} {{ article.category.name }}
          {% else %}
          ğŸ“ Generale
          {% endif %}
        </span>
        {% if article.ai_generated %}
        <span class="card-tag card-tag-ai">AI generated</span>
        {% else %}
        <span class="card-tag card-tag-secondary">Editoriale</span>
        {% endif %}
        {% if article.source_name and article.credibility_score %}
        {% set badge = get_credibility_badge(article.credibility_score) %}
        <span class="card-tag credibility-badge {{ badge.class }}"
          style="background: {{ badge.color }}20; border-color: {{ badge.color }}; color: {{ badge.color }};"
          title="{{ badge.label }}">
          {{ badge.badge }} {{ article.source_name }}
        </span>
        {% endif %}
      </div>

      <h3>
        <a href="/article/{{ article.slug }}">{{ get_lang_content(article, 'title', request.state.lang) }}</a>
      </h3>

      {% if get_lang_content(article, 'summary', request.state.lang) %}
      {% set summary = get_lang_content(article, 'summary', request.state.lang) %}
      <p>{{ summary }}</p>
      {% else %}
      {% set content = get_lang_content(article, 'content', request.state.lang) or article.content %}
      <p>{{ content[:260] }}...</p>
      {% endif %}
    </div>

    <div class="card-meta">
      <span>{{ article.created_at.strftime("%Y-%m-%d") }}</span>
      {% if article.source_url %}
      <span><a href="{{ article.source_url }}" target="_blank" style="color: var(--neon-cyan);">ğŸ“° Fonte</a></span>
      {% else %}
      <span></span>
      {% endif %}
    </div>
  </article>
  {% endfor %}
</section>

{% endblock %}