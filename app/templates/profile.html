{% extends "base.html" %}
{% block content %}

<div class="container container-narrow">
    <div class="profile-header" style="margin-bottom: 2rem; display: flex; align-items: center; gap: 1.5rem;">
        <div class="avatar-large" style="width: 80px; height: 80px; background: var(--bg-card); border: 2px solid var(--neon-cyan); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: var(--neon-cyan);">
            {{ user.username[0] | upper }}
        </div>
        <div>
            <h1 style="margin: 0; color: var(--text-main);">Ciao, <span style="color: var(--neon-cyan);">{{ user.username }}</span></h1>
            <p style="margin: 0.5rem 0 0; color: var(--text-muted);">{{ user.email }}</p>
            {% if user.is_subscribed %}
            <span class="pill pill-ai" style="margin-top: 0.5rem; display: inline-block;">Subscriber</span>
            {% endif %}
        </div>
    </div>

    <!-- Error/Success Messages -->
    {% if error %}
    <div class="alert alert-error" style="margin-bottom: 2rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; color: #ef4444; border-radius: 8px;">
        {{ error }}
    </div>
    {% endif %}
    {% if success %}
    <div class="alert alert-success" style="margin-bottom: 2rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; color: #10b981; border-radius: 8px;">
        {{ success }}
    </div>
    {% endif %}

    <div class="grid-2" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
        
        <!-- Change Password Section -->
        <div class="card" style="padding: 2rem;">
            <h2 style="margin-top: 0; margin-bottom: 1.5rem; font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem;">
                ðŸ”’ Sicurezza
            </h2>
            <form method="post" action="/profile/password">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="current_password" style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Password Attuale</label>
                    <input type="password" id="current_password" name="current_password" required
                           style="width: 100%; padding: 0.75rem; background: var(--bg-deep); border: 1px solid var(--border-dim); border-radius: 4px; color: var(--text-main);">
                </div>
                
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="new_password" style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Nuova Password</label>
                    <input type="password" id="new_password" name="new_password" required
                           style="width: 100%; padding: 0.75rem; background: var(--bg-deep); border: 1px solid var(--border-dim); border-radius: 4px; color: var(--text-main);">
                </div>

                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label for="confirm_password" style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Conferma Nuova Password</label>
                    <input type="password" id="confirm_password" name="confirm_password" required
                           style="width: 100%; padding: 0.75rem; background: var(--bg-deep); border: 1px solid var(--border-dim); border-radius: 4px; color: var(--text-main);">
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 0.75rem; background: var(--neon-cyan); color: #000; border: none; border-radius: 4px; font-weight: 600; cursor: pointer;">
                    Aggiorna Password
                </button>
            </form>
        </div>

        <!-- Activity Section (Placeholder) -->
        <div class="card" style="padding: 2rem;">
            <h2 style="margin-top: 0; margin-bottom: 1.5rem; font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem;">
                ðŸ“Š Le tue Statistiche
            </h2>
            <div class="stats-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="stat-item" style="text-align: center; padding: 1rem; background: var(--bg-deep); border-radius: 8px;">
                    <span style="display: block; font-size: 2rem; font-weight: 700; color: var(--neon-cyan);">{{ user.comments|length }}</span>
                    <span style="font-size: 0.85rem; color: var(--text-muted);">Commenti</span>
                </div>
                <div class="stat-item" style="text-align: center; padding: 1rem; background: var(--bg-deep); border-radius: 8px;">
                    <span style="display: block; font-size: 2rem; font-weight: 700; color: var(--neon-purple);">{{ (datetime.utcnow() - user.created_at).days }}</span>
                    <span style="font-size: 0.85rem; color: var(--text-muted);">Giorni unito</span>
                </div>
            </div>
            
            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-dim);">
                <p style="color: var(--text-muted); font-size: 0.9rem;">
                    Abbonamento attivo: 
                    {% if user.is_subscribed %}
                    <strong style="color: var(--neon-green);">SÃ¬</strong>
                    {% else %}
                    <strong style="color: var(--text-muted);">No</strong>
                    <br><br>
                    <a href="/subscribe" style="color: var(--neon-cyan);">Attiva ora per commentare!</a>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

{% endblock %}
